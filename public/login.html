<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IEP São Lucas — Acesso</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b1a2b;color:#fff;}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
    .card{background:#102846;border:1px solid #1c3e66;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:24px;min-width:360px;}
    .row{display:flex;gap:8px;align-items:center}
    .logo{height:56px;margin-bottom:12px}
    h1{margin:0 0 16px;font-size:20px;color:#9cd4ff}
    .field{margin:10px 0}
    .field span{display:block;font-size:12px;color:#9bbbd1;margin-bottom:6px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #2a4a74;background:#0f1f35;color:#fff}
    .btn{padding:10px 14px;border:0;border-radius:8px;background:#1e90ff;color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #2a4a74}
    .muted{font-size:12px;color:#8fb4d8}
    .hint{font-size:12px;color:#9bbbd1;margin-top:8px}
    .error{color:#ff6b6b;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <img src="/logo.png" alt="IEP São Lucas" class="logo" onerror="this.style.display='none'" />
      <h1>Bem-vindo ao IEP São Lucas</h1>
      <div class="field"><span>Login</span><input id="login" autocomplete="username" /></div>
      <div class="field"><span>Senha</span><input id="senha" type="password" autocomplete="current-password" /></div>
      <div class="row" style="justify-content:flex-end; gap:8px">
        <button class="btn ghost" onclick="showCadastro()">Cadastrar</button>
        <button class="btn" onclick="entrar()">Entrar</button>
      </div>
      <div class="row" style="justify-content:flex-end; gap:8px; margin-top:8px">
        <button class="btn ghost" onclick="entrarAdmin()">Entrar como administrador</button>
      </div>
      <div id="msg" class="error"></div>
      <div class="hint">Se você é administrador, use “Entrar como administrador”. Para colaboradores, o cadastro será aprovado pelo administrador.</div>
    </div>
  </div>
  <script>
    const API_BASE = '';
    function esc(s){ return String(s||'').replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }
    function showError(m){ document.getElementById('msg').textContent = m; }
    async function entrar(){
      const login = document.getElementById('login').value.trim();
      const senha = document.getElementById('senha').value;
      try{
        const res = await fetch(`${API_BASE}/auth/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({login,senha}) });
        const data = await res.json(); if(!res.ok){ showError(data.error||'Falha no login'); return; }
        localStorage.setItem('auth_token', data.token);
        window.location.href = '/';
      }catch(e){ showError('Erro ao autenticar'); }
    }
    async function entrarAdmin(){
      const senha = document.getElementById('senha').value;
      try{
        const res = await fetch(`${API_BASE}/auth/admin-login`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({senha}) });
        const data = await res.json(); if(!res.ok){ showError(data.error||'Falha admin'); return; }
        localStorage.setItem('auth_token', data.token);
        window.location.href = '/';
      }catch(e){ showError('Erro admin'); }
    }
    function showCadastro(){
      const card = document.querySelector('.card');
      card.innerHTML = `
        <img src="/logo.png" alt="IEP São Lucas" class="logo" onerror="this.style.display='none'" />
        <h1>Criar cadastro</h1>
        <div class="field"><span>Nome</span><input id="nome" /></div>
        <div class="field"><span>Email</span><input id="email" type="email" /></div>
        <div class="field"><span>Login</span><input id="rlogin" /></div>
        <div class="field"><span>Senha</span><input id="rsenha" type="password" /></div>
        <div class="row" style="justify-content:flex-end; gap:8px">
          <button class="btn ghost" onclick="window.location.reload()">Voltar</button>
          <button class="btn" onclick="cadastrar()">Enviar cadastro</button>
        </div>
        <div id="msg" class="error"></div>
        <div class="hint">Seu cadastro será enviado para aprovação do administrador. Administradores devem usar “Entrar como administrador”.</div>
      `;
    }
    async function cadastrar(){
      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const login = document.getElementById('rlogin').value.trim();
      const senha = document.getElementById('rsenha').value;
      try{
        const res = await fetch(`${API_BASE}/auth/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({nome,email,login,senha}) });
        const data = await res.json(); if(!res.ok){ showError(data.error||'Erro no cadastro'); return; }
        alert('Cadastro enviado para aprovação. Você receberá acesso após confirmação.');
        window.location.href = '/login.html';
      }catch(e){ showError('Erro no cadastro'); }
    }
  </script>
</body>
</html>